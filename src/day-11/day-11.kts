import kotlin.math.abs
import kotlin.math.ceil
import kotlin.math.exp

class Coordinate(val x: Int, val y: Int) {

    override fun equals(other: Any?): Boolean {
        if (other is Coordinate) {
            return other.x == x && other.y == y
        }
        return false
    }

    override fun hashCode(): Int {
        return 31 * x + y
    }

    override fun toString(): String {
        return "(x: $x, y: $y)"
    }
}

class Universe(private val tiles: MutableList<String>) {
    val emptyLines = mutableListOf<Int>()
    val emptyColumns = mutableListOf<Int>()
    val galaxies = computeGalaxies()

    private fun expand() {
        for (y in 0..<tiles.size) {
            if (!tiles[y].contains('#')) emptyLines.add(y)
        }
        var linesAdded = 0
        for (emptyLineIndex in emptyLines) {
            tiles.add(emptyLineIndex + linesAdded, tiles[emptyLineIndex + linesAdded])
            linesAdded += 1
        }

        for (x in 0..<tiles[0].length) {
            var hasGalaxy = false
            for (y in 0..<tiles.size) {
                if (tiles[y][x] == '#') {
                    hasGalaxy = true
                    break
                }
            }
            if (!hasGalaxy) {
                emptyColumns.add(x)
            }
        }
        linesAdded = 0
        for (emptyLineIndex in emptyColumns) {
            val index = emptyLineIndex + linesAdded
            for (y in 0..<tiles.size) {
                tiles[y] = tiles[y].substring(0, index) + '.' + tiles[y].substring(index)
            }

            linesAdded += 1
        }

    }

    private fun computeGalaxies(): List<Coordinate> {
        expand()

        val galaxiesFound = mutableListOf<Coordinate>()
        for (x in 0..<tiles[0].length) {
            for (y in 0..<tiles.size) {
                if (tiles[y][x] == '#') galaxiesFound.add(Coordinate(x, y))
            }
        }

        return galaxiesFound
    }

    fun getDistances(): Int {
        val pairs = mutableListOf<List<Coordinate>>()
        for (i in galaxies.indices) {
            for (j in i + 1..<galaxies.size) {
                pairs.add(mutableListOf(galaxies[i], galaxies[j]))
            }
        }

        var distances = 0
        for (pair in pairs) {
            distances += abs(pair[0].x - pair[1].x) + abs(pair[0].y - pair[1].y)
        }
        return distances
    }

    fun getDistances2(): Double {
        val pairs = mutableListOf<List<Coordinate>>()
        for (i in galaxies.indices) {
            for (j in i + 1..<galaxies.size) {
                pairs.add(mutableListOf(galaxies[i], galaxies[j]))
            }
        }

        var distances = 0.0
        for (pair in pairs) {
            val distanceX = emptyColumns.filter { (it > pair[0].x && it < pair[1].x) || (it > pair[1].x && it < pair[0].x) }.size
            val distanceY = emptyLines.filter { (it > pair[0].y && it < pair[1].y) || (it > pair[1].y && it < pair[0].y) }.size
            distances += abs(pair[0].x - pair[1].x) + abs(pair[0].y - pair[1].y) + (distanceX + distanceY) * 999998.0
        }
        return distances
    }

    override fun toString(): String {
        var printResult = ""

        for (line in tiles) {
            printResult += line + "\n"
        }

        return printResult
    }
}

fun main() {
    val data = mutableListOf(
            "...#......",
            ".......#..",
            "#.........",
            "..........",
            "......#...",
            ".#........",
            ".........#",
            "..........",
            ".......#..",
            "#...#....."
    )
//    val data = mutableListOf(
//            "...........#..........#...........................#....................#......#........................................................#....",
//            "...#........................#..............................#...................................................................#............",
//            "......................................#...................................................................#...........#.....................",
//            "...............................................#...............#.......................#....................................................",
//            "..........................................#...........#.............................................#.......................................",
//            "..........#.................................................................#................................#..............................",
//            "................................#.................................................................................#......#..................",
//            "..................................................................#.........................................................................",
//            "............................................................#..................#.......................................................#....",
//            "................................................#............................................#...............................#..............",
//            ".....#..............#..............................................................#................................#.......................",
//            ".........................................#...............................................#.................................................#",
//            "..............................#................................#.......#....................................................................",
//            "........................................................................................................................#...................",
//            "...#......#.......#.................#...................#......................................#.......#.......#........................#...",
//            "...........................................#...............................#....................................................#...........",
//            "...................................................................................#........................................................",
//            ".............#............#........................................#.......................................#......#.........................",
//            "................................#............................#...............................#..............................................",
//            "........................................#.............#.........................#......#......................................#.............",
//            "........................................................................................................#.....#.............................",
//            "......#............#...............#..............#.........................................................................................",
//            "...........#..................#............#.....................#..................................................#.......................",
//            ".......................................................................#..................#................#.......................#........",
//            "..#...................................#.....................................#.....#..................#......................................",
//            "............................................................................................................................................",
//            "............................#........................#.........................................#............................................",
//            ".......#......................................................................................................................#.............",
//            "......................#.......................................................#.............................................................",
//            ".#...........................................................#.....#..................................................#.................#...",
//            "..................................#....................................................#....................................................",
//            ".................................................................................#..............................#...........................",
//            "........#.................................#..........#......................................#............#..................................",
//            "..................#........................................................#................................................................",
//            ".............................#................#......................#...............................#..........................#......#....",
//            "..............#......................#..................................................................................#...................",
//            "...............................................................................................................#............................",
//            "..#.....................#.......................................#...................................................#.......................",
//            "..................................#....................#..........................................#.........................................",
//            "....................#.....................#......#.........................................................................#.......#........",
//            "............................................................#..........#...................................................................#",
//            "....#........................#................................................#...........#...............#......#..........................",
//            "............................................................................................................................................",
//            "..........#............................#....................................................................................................",
//            "...............#...............................#......#.............................................#.................................#.....",
//            "......................#..........#.........................#.......#..................................................#.....................",
//            "...............................................................................................................#..................#........#",
//            "............................................................................................................................................",
//            "#..........................#...............................................#.......#......#.................................................",
//            "............................................................................................................................................",
//            ".......#......................................................#............................................................#........#.......",
//            ".............................................#.........#............................................#.....#.................................",
//            "...............................#.......#....................................................................................................",
//            ".................................................................#..........................#..................#............................",
//            "..............#.....#.........................................................#......#.....................................................#",
//            ".................................................#.......#.............#....................................................................",
//            "..............................................................#............................................#................................",
//            ".#.......................#...............#.................................#.........................................................#......",
//            "....................................#.....................................................#..............................#..................",
//            ".....#...........#..............................................................................#.....#.....................................",
//            ".................................................................#.................#........................................................",
//            "............................................................................................................................................",
//            ".................................................#........................................................#.................................",
//            "........#.........................................................................................#...........................#..........#..",
//            "...............#........#...........#.....#........................#..............................................#................#........",
//            "........................................................................................#...................................................",
//            "...................................................................................#.........................#..............................",
//            "...#..............#....................................................#............................#.......................................",
//            "..............................#............................#................................................................................",
//            "........................................#.............................................................................................#.....",
//            "..............................................#..................#.............#........................#.................#.................",
//            "...................................................#.............................................................#..........................",
//            ".........#..................................................................................................................................",
//            ".......................#.....................................#.......#.....#..............................................................#.",
//            "................................................................................................#.....................#.....................",
//            "....#...........................#......................#.............................#.......................................#..............",
//            "...........................................................................................................#................................",
//            "...........#.......#........#..............................#.....................................................#..........................",
//            "............................................#...............................................#...............................................",
//            "....................................................................#..............#..................#..............#...............#......",
//            ".....................................#........................#.............................................................................",
//            "...............................................#............................................................#.................#............#",
//            "............................................................................................................................................",
//            "....#.......#...........................................................................................................#.........#.........",
//            "...................................#................#...........#..............................#............................................",
//            "............................................................................................................................................",
//            ".......................................................................#...........#......#..........#.......#..............................",
//            "..............................................................................#......................................................#......",
//            "...........................#.....................#..................................................................#.......................",
//            "..#............#............................#................................................#..............................................",
//            "...........................................................................................................................................#",
//            "........................................#...............#............#..........#......................................#....................",
//            "............#................................................#..............................................................................",
//            ".......#............................#...............#....................................#............#..........................#..........",
//            "......................#....................................................#................................................................",
//            "...............................................................................................#.............#.....#........................",
//            "..................#....................................#.........#...............#..........................................................",
//            ".............#...............#................#........................................#.................................................#..",
//            "...................................#....................................................................#...................#...............",
//            ".........................................#..........#.................#.....................................................................",
//            "................#............................................................#..............................................................",
//            "..........#.....................#........................#.....................................................................#............",
//            "....#.................................#.............................................................................................#.......",
//            "......................#.....#.......................................................................................#.......................",
//            "..............................................#.........................................#...................................................",
//            "..........................................................................................................#.................................",
//            "...................................................................#.........................................................#..............",
//            ".........#....................#.........#.........#...........#....................................#......................................#.",
//            "............................................................................................................................................",
//            "..#........................................................................#...............#.............................#..................",
//            "..............#...........#..........................................................#..........................................#...........",
//            "...................#.................................#...............................................#......................................",
//            "...............................#......................................................................................................#.....",
//            "...........................................#.................#........#.......................#.............................................",
//            ".....................................#.....................................................................#......#.......#.................",
//            "................#...............................#................................#......#..........#......................................#.",
//            "........................#...................................................................................................................",
//            "..............................#................................................................................................#............",
//            ".........................................................#...................#..........................#...................................",
//            "....#.......................................................................................................................................",
//            "........................................................................#........................#......................#.............#.....",
//            "............#...............#.............#.........#............................#........#................#................................",
//            ".....................#...............#..............................................................................#.......................",
//            "..................................................................#......................................................................#..",
//            "............................................................................................................................................",
//            "..............#........................................#.....................#.......#......................................................",
//            "........................#..............................................#..............................................#........#............",
//            "........................................#........................................#..........................................................",
//            ".......#........................#...................#.........#..............................................#..............................",
//            "..#................#......................................................................#........................................#........",
//            ".................................................................................................#.......................#..................",
//            "..............................................#.............................................................................................",
//            ".....#........#...........................................................................................#.........#........#..............",
//            ".................................................................................#..........#..........................................#....",
//            "..........................#...................................#.........#..............#.........................................#..........",
//            "............................................................................................................................................",
//            "....................................................................#.......#...................#...........................................",
//            "......................#.............#.............#.....................................................#...................................",
//            "........................................................#........................................................#..........................",
//            "..#..........#..........................#....................................................................................#.......#......"
//    )


    val universe = Universe(data)
    println("distances (part-1): " + universe.getDistances())
    println("distances (part-2): %.0f".format(universe.getDistances2()))
}

main()